<!DOCTYPE html>
<html lang="en">

<head>
    {{> head title="Bug: Mutating Array While Iterating" description="A classic bug when mutating an array while iterating over it. Example from a real snake game project." icon="/assets/icon/blog.png"}}
</head>

<body data-page="Blogs">
    <div data-header></div>

    <main class="blog-page">
        <article class="blog-article">
            <section class="blog-content">
                <h1>Mutating an Array While Iterating Over It</h1>

                <p>When I worked on a snake game at the company, I encountered a classic bug that was very hard to spot in a large codebase. It was the issue of mutating an array while iterating over it. You can see the example below:</p>

                <pre><code class="language-typescript">  const endTimer = this.time.delayedCall(TIME_GAME_LIMIT * 1000, () => {
            roomData.players.forEach((player) => {
              console.log(...roomData.players);
              console.log(player.id);
              console.log("[DEBUG]: " + roomData.players.length);
              this.killPlayer(player.id, DeathReason.TimesUp);
            });
          });</code></pre>

                <p><strong>Output:</strong></p>

                <pre><code class="language-plaintext">app-1  | { id: 'o-YtjCYy050TW9H0AAAB', type: 'snake', avatar: 'snake4' } { id: 'swzaRwreukn6J--NAAAD', type: 'human', avatar: 'human1' }
app-1  | o-YtjCYy050TW9H0AAAB                                                                                                                                                    
app-1  | [DEBUG]: 2</code></pre>

                <h2>What:</h2>
                <p>This is a simple example as you can see I'm iterating through each player in roomData. The first console.log shows 2 players, and roomData.players.length also shows 2, but <code>console.log(player.id);</code> only runs once.</p>

                <h2>Why:</h2>
                <p>The reason is that I'm calling the <code>killPlayer</code> function while iterating, and this function affects the <code>roomData</code> array by removing a player. This means there were initially 2 players, but when the loop runs, one player gets removed. That's why only one log appears even though there were initially 2.</p>

                <p>This is a classic bug that you can easily encounter when deleting an element from an array while iterating over it.</p>
            </section>
        </article>
        
        <!-- bottom bar with language switcher and back button -->
        <div class="blog-bottom-bar">
            <div class="blog-bottom-bar__container">
                <div class="btn-group" role="group" aria-label="Language switcher">
                    <a href="./en.html" class="btn btn--small btn--ghost is-active" aria-label="English version" data-tooltip="English">EN</a>
                    <a href="./vi.html" class="btn btn--small btn--ghost" aria-label="Vietnamese version" data-tooltip="Tiếng Việt">VI</a>
                </div>
                <a class="btn btn--small btn--ghost" href="/blogs.html" data-tooltip="Back to blogs">Back</a>
            </div>
        </div>
    </main>

    <div data-footer></div>
</body>

</html>

