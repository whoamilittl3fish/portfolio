---
/**
 * Blog Post Layout Component
 * Displays a single blog post with proper formatting
 */
import BaseLayout from './BaseLayout.astro';
import BottomNav from './BottomNav.astro';
import '../styles/components/blog-post.css';

interface Props {
  title: string;
  description: string;
  date: Date;
  lang: 'en' | 'vi';
  slug: string;
  langs?: ('en' | 'vi')[];
  tags?: string[];
}

const { title, description, date, lang, slug, langs = ['en', 'vi'], tags = [] } = Astro.props;

const formattedDate = new Intl.DateTimeFormat(lang === 'vi' ? 'vi-VN' : 'en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}).format(date);
---

<BaseLayout title={title} description={description} currentPage="blogs" hideBottomNav={true}>
  <article class="blog-post">
    <div class="blog-post__container">
      <header class="blog-post__header">
        <h1 class="blog-post__title">{title}</h1>
        <div class="blog-post__meta">
          <time datetime={date.toISOString()}>{formattedDate}</time>
          {tags.length > 0 && (
            <div class="blog-post__tags">
              {tags.map(tag => (
                <span class="pill">{tag}</span>
              ))}
            </div>
          )}
        </div>
      </header>
      
      <div class="blog-post__content">
        <slot />
      </div>
    </div>
  </article>
  
  <!-- Blog-specific bottom nav -->
  <BottomNav variant="blog" lang={lang} slug={slug} langs={langs} />
</BaseLayout>

<script>
  import { initLightboxForImages } from '../scripts/lightbox';
  import { fixShikiCodeBlocks } from '../scripts/code-block-fix';
  import { showMessageBox } from '../scripts/message-box';
  
  // Initialize lightbox for blog images
  initLightboxForImages();
  
  // Fix Shiki code block styling
  fixShikiCodeBlocks('.blog-post__content');

  // Expose showMessageBox globally for use in blog content
  // Can be called from HTML in markdown: <button onclick="showMessageBox('Content')">Click me</button>
  (window as any).showMessageBox = showMessageBox;

  // Auto-detect elements with data-message-box attribute
  // Usage in markdown: <button data-message-box="Your message here">Show Message</button>
  function initMessageBoxTriggers() {
    const triggers = document.querySelectorAll('[data-message-box]');
    triggers.forEach(trigger => {
      trigger.addEventListener('click', (e) => {
        e.preventDefault();
        const message = trigger.getAttribute('data-message-box');
        const title = trigger.getAttribute('data-message-box-title');
        if (message) {
          showMessageBox(message, title ? { title } : undefined);
        }
      });
    });
  }

  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMessageBoxTriggers);
  } else {
    initMessageBoxTriggers();
  }
</script>
